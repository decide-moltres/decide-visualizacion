{% extends "base.html" %}
{% load i18n static %}

{% block extrahead %}

    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,800" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="{% static 'booth/style.css' %}" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
    <!-- jQuery library -->
    <script src="js/jquery.min.js"></script>
    <!-- jsPDF library -->
    <script src="js/jsPDF/dist/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <!-- Morris for PDf create -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.1/dist/html2canvas.min.js"></script>
    <script src="http://connect.facebook.net/es_ES/all.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css" rel="stylesheet"/>
{% endblock %}

{% block content %}
<body>

<section>
    <div class="header">
        <div class="inner_header">
            <div class="logo_container">
                <h1> DECIDE </h1>
            </div>

            <ul class="navigation">
                <a><li>Quienes somos</li></a>
                <a><li>Contacto</li></a>

            </ul>
        </div>
    </div>
</section>

    <div class="switch">

        <ul>
            <li>
                <span>Dark</span>
                <span>Light</span>

            </li>
        </ul>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('ul').click(function(){
                $('ul').toggleClass('active')
                $('body').toggleClass('dark')
                $('button').toggleClass('dark')
           })
        })
     </script>

    <div id="app-visualizer">


        <div class="voting-container">
            <h1>  Votación [[ voting.id ]] - [[ voting.name ]]</h1>

            <h2 v-if="!voting.start_date">Votación no comenzada</h2>
            <h2 v-else-if="!voting.end_date">Votación en curso</h2>
            <div v-else>


                <div style="overflow-x:auto;">
                <table style="margin: 0 auto;" class="content-table"  >
                    <thead>
                        <tr>
                            <th>Opción</th>
                            <th>Puntuación</th>
                            <th>Votos</th>
                        </tr>
                    </thead>
                    <tbody>

                            <th>Benavides</th>
                            <td>20</td>
                            <td>20</td>
                    </tbody>
                    <tbody>
                            <th>Trinidad</th>
                            <td>100</td>
                            <td>100</td>

                    </tbody>

                     <tbody>
                            <th>Corchuelo</th>
                            <td>200</td>
                            <td>200</td>

                    </tbody>

                </table>
                </div>
            </div>
        </div>
        <!-- Botón que comparte en Facebook -->
        <a title="Compartir en Facebook" id="facebook"><img src="https://cdn.icon-icons.com/icons2/1099/PNG/128/1485482214-facebook_78681.png" height="40" width="40"></a>
    </div>

    <br>
    <br>
    <br>
<!--Aquí se colocan los "div" en los que van insertados ambos tipos de gráficas-->

    <div id="container-graficas" style="vertical-align: middle">
        <div id="graficaDonut" style="height: 250px; float:left; margin-left: 170px"></div>

        <div id="graficaBarras" style="height: 250px; width: 500px; float:left"></div>
    </div>

    <br>
    <br>

    <button class="btn btn1" id="graf1">Export this Chart to PNG</button>


    <button class="btn btn2" id="graf2">Export this Chart to PNG</button>

    <br>
    <br>

    <a title="Twittear"  style=" margin-left:50px;" id="twitter-share-button-linuxito.com"><img width="40" height="40" src="https://www.caminandoelmundoblog.com/wp-content/uploads/2017/11/Twitter-Download-PNG.png"></img></a>


    <button class="btn btn3" id="save">Export this votation to PDF</button>

    <a class="excel" href="excel"> Export this votation to excel</a>




    <!-- Enlace para compartir en twitter -->

    <a title="Twittear" id="twitter-share-button-linuxito.com"><img width="40" height="40" src="https://www.caminandoelmundoblog.com/wp-content/uploads/2017/11/Twitter-Download-PNG.png"></img></a>
    <!-- Enlace para compartir en tumblr -->
    <a title="Tumblr" id="tumblr-share-button-linuxito.com"><img width="40" height="40" src="https://miro.medium.com/max/450/1*dh98kywL_OR71I7bJ2NCfQ.jpeg"></img></a>

{% endblock %}

{% block extrabody %}

<!-- Script que comparte en twitter la url en twitter -->
<script>

    var twitterShareButton = document.getElementById('twitter-share-button-linuxito.com');
    var twitterShareButtonHref='https://twitter.com/share?';
    twitterShareButtonHref += 'url='+document.URL;
    twitterShareButtonHref += '&via=linuxitux';
    twitterShareButtonHref += '&text='+document.title+' Encuentra los resultado de las votaciones en nuestra pagina!'+
    ' Accede a través del siguiente enlace!';
    twitterShareButton.href = twitterShareButtonHref;

</script>

<!-- Script que comparte en tumblr la url de decide!-->
<script>

    var tumblrShareButton = document.getElementById('tumblr-share-button-linuxito.com');
    var tumblrShareButtonHref='http://www.reddit.com/submit?';
    tumblrShareButtonHref += 'url='+document.URL + ' Desde este enlace puedes acceder a los resultados!';
    tumblrShareButtonHref += '&via=linuxitux';
    tumblrShareButtonHref += '&title='+document.title+' Encuentra los resultado de las votaciones en nuestra pagina!'+
    ' Accede a través del siguiente enlace!';
    tumblrShareButton.href = tumblrShareButtonHref;

</script>

    <!-- Vuejs -->
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>

    <script>
        var voting = {{voting|safe}};
        var app = new Vue({
            delimiters: ['[[', ']]'],
            el: '#app-visualizer',
            data: {
                voting: voting
            }
        }) 
    </script>
    <script>

// Con esta función, conseguimos extraer los datos necesarios para que la librería morris
// pueda trabajar con ellos. En concreto, extraemos, de cada uno de los resultados, el nombre
// de este y su número de votos obtenidos.
function extraerDatos(a) {
    var res = [];
    var name = "";
    var votes = "";
    // Para cada resultado:
    for (var i = 0; i  < a; i++)  {
        // Nombre
        name = voting.postproc[i].option  
        // Número de votos
        votes = voting.postproc[i].votes
        // Se añade al array que devolvemos
        res.push({
            label: name, value: votes
        });
    }
    return res;
}

// Elemento de la librería de Morris que trabaja con la gráfica de Barras.
// Recibe: "element": nombre del div en el que es insertada la gráfica;
// "data" : donde insertamos un dato de ejemplo, ya que es indispensable para garantizar
// la creación correcta de la gráfica
// "xkey": Indica el nombre de los elementos situados en el eje X
// "ykey": Indica, en un array, el nombre de los elementos situados en el eje Y

var graphBar = new Morris.Bar({
  element: 'graficaBarras',
  data: [
      {label: "Trinidad", value: 20},
      {label: "Benavides", value: 100},
      {label: "Corchu", value: 10}
  ],
  xkey: 'label',
  ykeys: ['value'],
  labels: ['Votos'],
  barColors: ['#FE4646', '#C60101', ' #FE8686', '#FEDCDC', '#E2E1E1']

});

// Elemento de la librería de Morris que trabaja con la gráfica de Donut/Queso.
// Recibe: "element": nombre del div en el que es insertada la gráfica;
// "data" : donde insertamos un dato de ejemplo, ya que es indispensable para garantizar
// "colors": Un array donde añadimos el nombre de los colores que deseamos que se usen en la gráfica
var graphDonut =  new Morris.Donut({
   element: 'graficaDonut',
   data: [
      {label: "Trinidad", value: 20},
      {label: "Benavides", value: 100},
      {label: "Corchu", value: 10}
  ],
   colors: ['#800000', '#FE4646', ' #FE8686', '#FEDCDC', '#E2E1E1']
 });

// Por último, encontramos el método que hace todo posible, "setData". Este método que contiene
// la librería de Morris nos facilita la actualización de los "data" de ambas gráficas. En este caso
// añadimos nuestro método de extraer datos y le indicamos que lo haga con el número de resultados provenientes
// del postprocesado.
//graphBar.setData(extraerDatos(voting.postproc.length))
//graphDonut.setData(extraerDatos(voting.postproc.length))
    </script>

    <script>
    $("#save").click(function() {

    var doc = new jsPDF();
        
    //Obtiene la información del html
    var elementHTML = $('#app-visualizer').html();
    var specialElementHandlers = {
        '#elementH': function (element, renderer) {
            return true;
    }
    };

    //Añade las propiedades basicas del pdf
    doc.setProperties({
	title: 'Datos votaciones',
	subject: 'Votaciones',		
	author: 'Decide-Moltres-Vosualizacion',
    });

    margins = {
            top: 15,
            bottom: 60,
            left: 15,
            width: 522
        };

    doc.setFont("courier");
    doc.setTextColor(255,0,0);

    doc.fromHTML(elementHTML, margins.left, margins.top, {
        'width': 170,
        'elementHandlers': specialElementHandlers
    });

    // Guarda el PDF con los datos
    doc.save('datos-votacion.pdf');

    }).catch(function(e) {
        console.log(e.message);
    });


    </script>

<script>
    $("#graf1").click(function() {
    //Obtiene los valores de las imagenes que se van a generar
	html2canvas(document.getElementById('graficaDonut')).then(canvas => {
        var w = document.getElementById("graficaDonut").offsetWidth;
        var h = document.getElementById("graficaDonut").offsetHeight;

        //Co vierte el gráfico en una imagen
        var img = canvas.toDataURL("image/png", 1);

        var doc = new jsPDF('L', 'pt', [w, h]);

        //Añade la imagen al pdf
        doc.addImage(img, 'JPEG', 10, 10, w, h);

        doc.save('GraficaDonut.pdf');

    }).catch(function(e) {
        console.log(e.message);
    });
})
</script>

<script>
    $("#graf2").click(function() {
	html2canvas(document.getElementById('graficaBarras')).then(canvas => {
        var w = document.getElementById("graficaBarras").offsetWidth;
        var h = document.getElementById("graficaBarras").offsetHeight;

        var img = canvas.toDataURL("image2/jpeg", 1);

        var doc = new jsPDF('L', 'pt', [w, h]);

        doc.addImage(img, 'JPEG', 10, 10, w, h);

        doc.save('GraficaBarras.pdf');

    }).catch(function(e) {
        console.log(e.message);
    });
})
</script>

<script>
    // Primero, llamamos al botón
    var facebookShareButton = document.getElementById('facebook');
    // Llamamos al link que nos permite compartir en Facebook
    var facebookShareButtonHref='https://www.facebook.com/sharer/sharer.php?'
    // Añadimos la URL de la página que queremos compartir, en este caso, la actual de este documento
    // NOTA: Una URL que contenga localhost no funciona, ya que entra en conflicto con los entornos locales del propio Facebook
    facebookShareButtonHref = facebookShareButtonHref + 'u='+document.URL;
    // Añadimos el título de la página como título de la publicación a compartir en Facebook
    facebookShareButtonHref = facebookShareButtonHref + '&quote='+document.title;
    // Se añade la URL completa
    facebookShareButton.href = facebookShareButtonHref;
   
</script>

<footer>

    <div class="container-footer-all">
        <div class="container-body">

            <div class="colum1">
                <h1> Más información de la plataforma </h1>

                <p> El objetivo de este proyecto es implementar una plataforma de voto electrónico seguro,
                    que cumpla una serie de garantías básicas, como la anonimicidad y el secreto del voto.
                    Se trata de un proyecto educativo, pensado para el estudio de sistemas de votación,
                    por lo que prima la simplicidad por encima de la eficiencia cuando sea posible.
                    Por lo tanto se asumen algunas carencias para permitir que sea entendible y extensible.

            </div>

            <div class="colum2">
                <h1> Información de contacto</h1>
                <div class="row1">
                    <i class="fa fa-home" style="font-size:25px;color:white"></i>
                    <label> Escuela Técnica Superior de Ingeniería Informática, Universidad de Sevilla, 41012 Sevilla</label>
                </div>

                <div class="row2">
                    <i class="fa fa-envelope" style="font-size:20px;color:white"></i>
                    <label> decide-visualizacion-moltres@gmail.com</label>
                </div>

                <div class="row3">
                    <i class="fa fa-internet-explorer" style="font-size:20px;color:white"></i>
                    <label> https://1984.lsi.us.es/wiki-egc </label>
                </div>

            </div>

        </div>

        <div class="container-footer">

                <div class="copyright">
                    © Todos los derechos reservados
                </div>
        </div>

    </div>
</footer>

</body>




</body>
{% endblock %}
